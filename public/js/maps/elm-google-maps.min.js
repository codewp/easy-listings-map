(function(h,g){var d=infoBubble=markerClusterer=animatedMarker=null;var k=true;var f=[];g.initializeListingMap=function l(){if(d){return}var a=[];for(i=0,max=elm_google_maps.map_types.length;i<max;i++){if('ROADMAP'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.ROADMAP)}else if('SATELLITE'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.SATELLITE)}else if('HYBRID'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.HYBRID)}else if('TERRAIN'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.TERRAIN)}}if(!a.length){a.push(google.maps.MapTypeId.ROADMAP)}var c=new google.maps.LatLng(elm_google_maps.default_latitude,elm_google_maps.default_longitude);var e={zoom:parseInt(elm_google_maps.zoom),center:c,mapTypeControl:true,scrollwheel:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:a},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT,position:google.maps.ControlPosition.RIGHT_TOP},streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}};d=new google.maps.Map(document.getElementById(elm_google_maps.map_id),e);infoBubble=n();var b=elm_google_maps.markers;b=jQuery.parseJSON(b);if(b.length){o(b);p()}if('1'===elm_google_maps.auto_zoom&&f.length){mapAutoZoom()}else if(f.length){d.setCenter(f[0].position)}if('-1'!==elm_google_maps.limit){google.maps.event.addListener(d,'dragend',q);google.maps.event.addListener(d,'zoom_changed',q)}}if('object'===typeof google&&'object'===typeof google.maps){h(function(){if(h('#'+elm_google_maps.map_id).is(':visible')){l()}else{h('a[data-toggle="tab"]').on('shown shown.bs.tab',function(a){if(h('#'+elm_google_maps.map_id).is(':visible')){l()}});h('ul.ui-tabs-nav li, ul.z-tabs-nav li').on('click',function(a){if(h('#'+elm_google_maps.map_id).is(':visible')){l()}})}});google.maps.event.addDomListener(g,'resize',function(){if(d){var a=d.getCenter();google.maps.event.trigger(d,"resize");d.setCenter(a)}})}g.getInfoWindow=function r(e,b){return function(){var a=infoBubble.get('position');if(typeof a==='undefined'||(typeof a!=='undefined'&&e.position.lat()!==a.lat()&&e.position.lng()!==a.lng())){infoBubble.close();infoBubble=n();var c='';infoBubble.setCloseButtonStyle('margin-right','8px');if(b.info.length>1){for(i=0,max=b.info.length;i<max;i++){c='<div class="property-infobubble-content"><a href="'+decodeURIComponent(b.info[i].url)+'">'+b.info[i].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(b.info[i].url)+'">'+b.info[i].title+'</a></div><div class="property-type-status">'+b.info[i].property_type+' - '+b.info[i].property_status+'</div><div class="property-feature-icons epl-clearfix">'+b.info[i].icons+'</div></div>';infoBubble.addTab(b.info[i].tab_title,c)}infoBubble.setCloseButtonStyle('margin-top','12px')}else{c='<div class="property-infobubble-content"><a href="'+decodeURIComponent(b.info[0].url)+'">'+b.info[0].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(b.info[0].url)+'">'+b.info[0].title+'</a></div><div class="property-type-status">'+b.info[0].property_type+' - '+b.info[0].property_status+'</div><div class="property-feature-icons epl-clearfix">'+b.info[0].icons+'</div></div>';infoBubble.setContent(c);infoBubble.setCloseButtonStyle('margin-top','8px')}}if(!infoBubble.isOpen()){infoBubble.open(d,e)}}}g.getBoundMarkers=function q(){if(!k){k=true;return}var c=d.getBounds();var e=c.getSouthWest();var b=c.getNorthEast();var j=e.lat();var m=e.lng();var s=b.lat();var t=b.lng();jQuery.ajax({type:'POST',url:elmPublicAjaxUrl,data:{'action':'load_map_markers','nonce':elm_google_maps.nonce,'southWestLat':j,'southWestLng':m,'northEastLat':s,'northEastLng':t,'post_type':elm_google_maps.post_type,'status':elm_google_maps.status,'order':elm_google_maps.order,'cluster_size':elm_google_maps.cluster_size}}).done(function(a){a=jQuery.parseJSON(a);if(1===a.success){u(a.markers)}else if(0===a.success){console.log(a.message)}})}g.removeMarkers=function v(){if(markerClusterer){markerClusterer.clearMarkers()}f=[]}g.createMarkers=function o(a){if(a.length){var c;for(i=0,max=a.length;i<max;i++){c=new google.maps.Marker({position:new google.maps.LatLng(a[i].latitude,a[i].longitude),icon:a[i]['marker_icon'],listing_id:a[i]['listing_id']});f.push(c);google.maps.event.addListener(c,'click',r(c,a[i]))}}}g.addMarkersToCluster=function p(){if(f.length){var c=elm_google_maps.cluster_size==-1?null:parseInt(elm_google_maps.cluster_size,10);markerClusterer=new MarkerClusterer(d,f,{ignoreHidden:true,maxZoom:14,gridSize:c,styles:elm_google_maps.cluster_style});google.maps.event.addListener(markerClusterer,'click',function(a){console.log(a.getMarkers())})}}g.addListingsToMap=function u(a){v();if(a.length){o(a);p()}}g.animateListingMarker=function w(a,c){if(!c){c=google.maps.Animation.BOUNCE}for(var e=0,b=f.length;e<b;e++){for(var j=0,m=f[e]['listing_id'].length;j<m;j++){if(a==f[e]['listing_id'][j]){animatedMarker=f[e];f[e].setAnimation(c);return}}}}g.stopAnimatedMarker=function x(){if(animatedMarker){animatedMarker.setAnimation(null)}}g.mapAutoZoom=function(){var a=new google.maps.LatLngBounds();for(i=0,max=f.length;i<max;i++){a.extend(f[i].getPosition())}d.setCenter(a.getCenter());d.fitBounds(a);k=false;d.setZoom(d.getZoom()-1>=0?d.getZoom()-1:d.getZoom());if(d.getZoom()>15){k=false;d.setZoom(15)}}g.generateInfoBubble=function n(){return new InfoBubble({maxWidth:300,maxHeight:300,closeSrc:elm_google_maps.info_window_close})}InfoBubble.prototype.setCloseButtonStyle=function(a,c){this.close_.style[a]=c}})(jQuery,window);

(function(h,e){var c=infoBubble=markerClusterer=null;var j=true;var f=[];e.initializeListingMap=function k(){if(c){return}var a=[];for(i=0,max=elm_google_maps.map_types.length;i<max;i++){if('ROADMAP'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.ROADMAP)}else if('SATELLITE'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.SATELLITE)}else if('HYBRID'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.HYBRID)}else if('TERRAIN'===elm_google_maps.map_types[i]){a.push(google.maps.MapTypeId.TERRAIN)}}if(!a.length){a.push(google.maps.MapTypeId.ROADMAP)}var d=new google.maps.LatLng(elm_google_maps.default_latitude,elm_google_maps.default_longitude);var g={zoom:parseInt(elm_google_maps.zoom),center:d,mapTypeControl:true,scrollwheel:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:a},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT}};c=new google.maps.Map(document.getElementById(elm_google_maps.map_id),g);infoBubble=l();var b=elm_google_maps.markers;b=jQuery.parseJSON(b);if(b.length){m(b);n()}if('1'===elm_google_maps.auto_zoom&&f.length){mapAutoZoom()}else if(f.length){c.setCenter(f[0].position)}if('-1'!==elm_google_maps.limit){google.maps.event.addListener(c,'dragend',o);google.maps.event.addListener(c,'zoom_changed',o)}}if('object'===typeof google&&'object'===typeof google.maps){h(function(){if(h('#'+elm_google_maps.map_id).is(':visible')){k()}else{h('a[data-toggle="tab"]').on('shown shown.bs.tab',function(a){if(h('#'+elm_google_maps.map_id).is(':visible')){k()}});h('ul.ui-tabs-nav li, ul.z-tabs-nav li').on('click',function(a){if(h('#'+elm_google_maps.map_id).is(':visible')){k()}})}});google.maps.event.addDomListener(e,'resize',function(){if(c){var a=c.getCenter();google.maps.event.trigger(c,"resize");c.setCenter(a)}})}e.getInfoWindow=function p(g,b){return function(){var a=infoBubble.get('position');if(typeof a==='undefined'||(typeof a!=='undefined'&&g.position.lat()!==a.lat()&&g.position.lng()!==a.lng())){infoBubble.close();infoBubble=l();var d='';infoBubble.setCloseButtonStyle('margin-right','8px');if(b.info.length>1){for(i=0,max=b.info.length;i<max;i++){d='<div class="property-infobubble-content"><a href="'+decodeURIComponent(b.info[i].url)+'">'+b.info[i].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(b.info[i].url)+'">'+b.info[i].title+'</a></div><div class="property-type-status">'+b.info[i].property_type+' - '+b.info[i].property_status+'</div><div class="property-feature-icons epl-clearfix">'+b.info[i].icons+'</div></div>';infoBubble.addTab(b.info[i].tab_title,d)}infoBubble.setCloseButtonStyle('margin-top','12px')}else{d='<div class="property-infobubble-content"><a href="'+decodeURIComponent(b.info[0].url)+'">'+b.info[0].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(b.info[0].url)+'">'+b.info[0].title+'</a></div><div class="property-type-status">'+b.info[0].property_type+' - '+b.info[0].property_status+'</div><div class="property-feature-icons epl-clearfix">'+b.info[0].icons+'</div></div>';infoBubble.setContent(d);infoBubble.setCloseButtonStyle('margin-top','8px')}}if(!infoBubble.isOpen()){infoBubble.open(c,g)}}}e.getBoundMarkers=function o(){if(!j){j=true;return}var d=c.getBounds();var g=d.getSouthWest();var b=d.getNorthEast();var q=g.lat();var r=g.lng();var s=b.lat();var t=b.lng();jQuery.ajax({type:'POST',url:elmPublicAjaxUrl,data:{'action':'load_map_markers','nonce':elm_google_maps.nonce,'southWestLat':q,'southWestLng':r,'northEastLat':s,'northEastLng':t,'post_type':elm_google_maps.post_type,'status':elm_google_maps.status,'order':elm_google_maps.order,'cluster_size':elm_google_maps.cluster_size}}).done(function(a){a=jQuery.parseJSON(a);if(1===a.success){u(a.markers)}else if(0===a.success){console.log(a.message)}})}e.removeMarkers=function v(){if(markerClusterer){markerClusterer.clearMarkers()}f=[]}e.createMarkers=function m(a){if(a.length){var d;for(i=0,max=a.length;i<max;i++){d=new google.maps.Marker({position:new google.maps.LatLng(a[i].latitude,a[i].longitude),icon:a[i]['marker_icon']});f.push(d);google.maps.event.addListener(d,'click',p(d,a[i]))}}}e.addMarkersToCluster=function n(){if(f.length){var d=elm_google_maps.cluster_size==-1?null:parseInt(elm_google_maps.cluster_size,10);markerClusterer=new MarkerClusterer(c,f,{ignoreHidden:true,maxZoom:14,gridSize:d,styles:elm_google_maps.cluster_style});google.maps.event.addListener(markerClusterer,'click',function(a){console.log(a.getMarkers())})}}e.addListingsToMap=function u(a){v();if(a.length){m(a);n()}}e.mapAutoZoom=function(){var a=new google.maps.LatLngBounds();for(i=0,max=f.length;i<max;i++){a.extend(f[i].getPosition())}c.setCenter(a.getCenter());c.fitBounds(a);j=false;c.setZoom(c.getZoom()-1>=0?c.getZoom()-1:c.getZoom());if(c.getZoom()>15){j=false;c.setZoom(15)}}e.generateInfoBubble=function l(){return new InfoBubble({maxWidth:300,maxHeight:300,closeSrc:elm_google_maps.info_window_close})}InfoBubble.prototype.setCloseButtonStyle=function(a,d){this.close_.style[a]=d}})(jQuery,window);
